import{V as G,r as N,W as R,M as $,t as i,X as F,Y as B,j as e,L as b}from"./index-DYkXUbAd-a4e89c2.js";import{c as O,B as m}from"./button-h1DSpZXA-a4e89c2.js";import{C as h,d as u,a as y,b as _}from"./card-6zQJLbWN-a4e89c2.js";import{S as H}from"./separator-CDsBHTd5-a4e89c2.js";import{B as q}from"./badge-DXx4OOjf-a4e89c2.js";import{i as U,l as z,j as X,b as d,h as K}from"./formatters-DEd21KnF-a4e89c2.js";import{A as V,a as W,b as Y,c as J,d as Q,e as Z,f as ee,g as se,h as ae}from"./alert-dialog-BH6nPqvF-a4e89c2.js";import{u as v,a as re,e as te,b as p}from"./index.esm-5B-ngkc2-a4e89c2.js";import{A as le}from"./arrow-left-B-fE1lm9-a4e89c2.js";import{C as E}from"./check-DnmYPILq-a4e89c2.js";import{A}from"./arrow-right-BiWt_vhK-a4e89c2.js";import{B as ne}from"./book-open-C7OT0mOx-a4e89c2.js";import{F as ie}from"./file-text-BcFMuN2F-a4e89c2.js";import{C as w}from"./calendar-B7fxJ1Ph-a4e89c2.js";import{P as D}from"./package-BqvnQu9A-a4e89c2.js";import{C as ce}from"./credit-card-CLQRtNry-a4e89c2.js";import"./utils-CqKNptqL-a4e89c2.js";import"./index-uuJbZfHU-a4e89c2.js";import"./circle-check-big-C7bY-h86-a4e89c2.js";import"./index-DSgaOyvB-a4e89c2.js";import"./index-qSm60C2k-a4e89c2.js";import"./index-Dc_FVRD7-a4e89c2.js";import"./index-BD437pot-a4e89c2.js";import"./index-FtHhtt_g-a4e89c2.js";import"./index-DTi5DdSp-a4e89c2.js";import"./index-CLelF_q0-a4e89c2.js";import"./tslib.es6-B8VhMk5P-a4e89c2.js";import"./index-DTBUfsoF-a4e89c2.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],oe=O("dollar-sign",de);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],xe=O("house",me),l={PENDING:0,PROCESSING:1,CANCELLED:2,COMPLETED:3,DEDUCTED:4},he=[{key:"month_price",label:"月付"},{key:"quarter_price",label:"季付"},{key:"half_year_price",label:"半年付"},{key:"year_price",label:"年付"},{key:"two_year_price",label:"两年付"},{key:"three_year_price",label:"三年付"},{key:"onetime_price",label:"一次性"},{key:"reset_price",label:"流量重置包"}],ue=f=>{const t=he.find(n=>n.key===f);return t?t.label:f},qe=function(){const t=G.useLoaderData(),[n,g]=N.useState(null),{data:s}=v(R(t.order.trade_no),{initialData:t.order,middleware:re("getOrderDetail"),force:({args:a})=>!!a[0]}),c=U(s.status,!0),k=z(s.type),S=c.icon,{send:M,loading:x}=v($,{immediate:!1}).onSuccess(()=>{i.success("订单已取消")});te(F(s.trade_no),{pollingTime:s.status===l.PENDING?1e3:0,middleware(a,r){s.status===l.PENDING&&r()}}).onSuccess(({data:a})=>{switch(a){case l.PENDING:break;case l.PROCESSING:i.info("订单正在开通中..."),p("getOrderDetail",r=>{r.send(!0)});break;case l.CANCELLED:i.error("订单已被取消"),p("getOrderDetail",r=>{r.send(!0)});break;case l.COMPLETED:i.success("订单已支付完成"),p("getOrderDetail",r=>{r.send(!0)});break;case l.DEDUCTED:i.success("订单已完成折抵"),p("getOrderDetail",r=>{r.send(!0)});break;default:console.warn("未知的订单状态:",a);break}});const{send:P,loading:C}=v(B,{immediate:!1}).onSuccess(({data:a})=>{a!==!0&&(typeof a=="string"&&a.trim()?(window.open(a,"_blank"),i.success("正在跳转到支付页面...")):i.error("获取支付链接失败"))});N.useEffect(()=>{t.paymentMethods&&t.paymentMethods.length>0&&n===null&&g(t.paymentMethods[0].id)},[t.paymentMethods,n]);const j=N.useMemo(()=>{if(!n||!t.paymentMethods)return 0;const a=t.paymentMethods.find(L=>L.id===n);if(!a)return 0;const r=s.total_amount||0;if(r===0)return 0;const o=Number(a.handling_fee_fixed)||0,I=Number(a.handling_fee_percent)||0,T=r*I/100;return o+T},[n,t.paymentMethods,s.total_amount]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{to:"/order",children:e.jsxs(m,{variant:"ghost",size:"sm",className:"h-9 px-3",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"返回订单列表"}),e.jsx("span",{className:"sm:hidden",children:"返回"})]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground",children:"订单详情"})})]}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${c.bgColor} ${c.borderColor} shadow-sm`,children:[e.jsx(S,{className:`h-5 w-5 ${c.color}`}),e.jsx("span",{className:`font-semibold ${c.color}`,children:c.label})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[(s.status===l.COMPLETED||s.status===l.DEDUCTED)&&e.jsx(h,{className:"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50 dark:border-green-800 dark:from-green-950 dark:to-emerald-950",children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(E,{className:"h-6 w-6"}),e.jsx("span",{className:"text-lg font-semibold",children:"订单已完成"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"您的订单已成功完成，现在可以开始使用服务了"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(b,{to:"/dashboard",children:e.jsxs(m,{variant:"default",className:"w-full h-11 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-lg text-white",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"前往仪表板",e.jsx(A,{className:"ml-2 h-4 w-4"})]})}),e.jsx(b,{to:"/knowledge",children:e.jsxs(m,{variant:"outline",className:"w-full h-11 border-primary/20 text-primary hover:bg-primary/10",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"查看使用教程",e.jsx(A,{className:"ml-2 h-4 w-4"})]})})]})]})})}),e.jsxs(h,{children:[e.jsx(y,{className:"pb-4",children:e.jsxs(_,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),"订单信息"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"订单号"]}),e.jsx("p",{className:"text-sm text-foreground",children:s.trade_no})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"创建时间"]}),e.jsx("p",{className:"text-sm text-foreground",children:X(s.created_at)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),"订单类型"]}),e.jsx(q,{className:`text-xs ${k.color}`,children:k.label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"套餐名称"]}),e.jsx("p",{className:"text-sm text-foreground",children:s.plan.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"流量配额"]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.plan.transfer_enable," GB"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"服务周期"]}),e.jsx("p",{className:"text-sm text-foreground",children:ue(s.period)})]})]})})]}),s.status===l.PENDING&&e.jsxs(h,{children:[e.jsx(y,{children:e.jsx(_,{children:"选择支付方式"})}),e.jsxs(u,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:t.paymentMethods.map(a=>{const r=n===a.id;return e.jsxs("div",{className:`relative cursor-pointer rounded-lg border-2 p-4 transition-all duration-200 ${r?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,onClick:()=>g(a.id),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),g(a.id))},tabIndex:0,role:"button","aria-pressed":r,children:[r&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(E,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:a.icon,alt:a.name,className:"h-8 w-8 object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${r?"text-primary":"text-foreground"}`,children:a.name}),(Number(a.handling_fee_fixed)>0||Number(a.handling_fee_percent)>0)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["手续费:",a.handling_fee_fixed>0&&`¥${(a.handling_fee_fixed/100).toFixed(2)}`,Number(a.handling_fee_fixed)>0&&Number(a.handling_fee_percent)>0&&" + ",Number(a.handling_fee_percent)>0&&`${a.handling_fee_percent}%`]})]})]})]},a.id)})}),t.paymentMethods.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"暂无可用的支付方式"})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(h,{children:[e.jsx(y,{className:"pb-4",children:e.jsxs(_,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5 text-primary"})}),"金额明细"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"原价"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["¥",d(Number(s.plan[s.period]))]})]}),s.discount_amount&&s.discount_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"优惠金额"}),e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["-¥",d(s.discount_amount)]})]}),s.balance_amount&&s.balance_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"余额抵扣"}),e.jsxs("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:["-¥",d(s.balance_amount)]})]}),s.refund_amount&&s.refund_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"退款金额"}),e.jsxs("span",{className:"font-semibold text-destructive",children:["¥",d(s.refund_amount)]})]}),s.status===l.PENDING&&j>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"手续费"}),e.jsxs("span",{className:"font-semibold text-orange-600 dark:text-orange-400",children:["¥",d(j)]})]}),e.jsx(H,{className:"my-3"}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:"应付金额"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["¥",d(s.status===l.PENDING?s.total_amount+j:s.total_amount)]})]}),s.status===l.PENDING&&e.jsxs(m,{className:"w-full h-12 text-base font-semibold bg-primary hover:bg-primary/90 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n||C,onClick:()=>{n&&P(s.trade_no,n)},children:[e.jsx(ce,{className:"mr-2 h-5 w-5"}),C?"处理中...":"立即支付"]}),s.status===l.PENDING&&e.jsxs(V,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full h-11 border-destructive/20 text-destructive hover:bg-destructive/10",disabled:x,children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),x?"取消中...":"取消订单"]})}),e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"确认取消订单"}),e.jsx(Z,{children:"确定要取消订单吗？如果您已经付款，取消订单可能会导致支付失败！"})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"取消"}),e.jsx(ae,{onClick:async()=>{M(s.trade_no)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:x,children:x?"取消中...":"确认取消"})]})]})]})]})]})})]})]})};export{qe as component};
