import{Q as d,r as o,o as f,S as h,T as j,t as g,j as e,L as y,s as N}from"./index-teSdE2Jt-60836a6.js";import{C as v,a as b,b as T}from"./card-BY_5Pg1h-60836a6.js";import{c as C,B as p}from"./button-DFydWqCY-60836a6.js";import{T as R}from"./textarea-0u0FPYJl-60836a6.js";import{S}from"./scroll-area-BD8YcUbP-60836a6.js";import{j as k}from"./formatters-Cd4Esa66-60836a6.js";import{e as w,u as F}from"./index.esm-DE8N10JJ-60836a6.js";import{u as L,a as _,F as A,b as D,c as I,d as M,e as q,f as E}from"./zod-kiWOCZmW-60836a6.js";import{A as H}from"./arrow-left-D8TxNoZJ-60836a6.js";import"./utils-Cgka2yTa-60836a6.js";import"./index-DfSyQ0vC-60836a6.js";import"./index-Utykh1Tj-60836a6.js";import"./index-BT911meO-60836a6.js";import"./index-D6j6wo2e-60836a6.js";import"./index-BzUjaRiw-60836a6.js";import"./index-BdQq_4o_-60836a6.js";import"./index-Dc_FVRD7-60836a6.js";import"./package-DIBXWkZn-60836a6.js";import"./circle-check-big-B-6C6Q2F-60836a6.js";import"./label-CuUGKL_3-60836a6.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],$=C("user",B),z=f({message:N().min(1,"请输入回复内容")}),me=function(){const{id:c}=d.useParams(),l=d.useLoaderData(),t=o.useRef(null),m=o.useRef(0),r=L({resolver:_(z),defaultValues:{message:""}}),{data:a}=w(()=>h(parseInt(c)),{pollingTime:1e3,initialData:l,immediate:l.status===1});o.useEffect(()=>{if(a?.message&&t.current){const s=a.message.length;if(s>m.current){const i=t.current.querySelector('[data-slot="scroll-area-viewport"]');i&&(i.scrollTop=i.scrollHeight)}m.current=s}},[a?.message]);const{loading:n,send:x}=F(s=>j(parseInt(c),s),{immediate:!1}).onSuccess(()=>{g.success("回复成功"),r.reset()}),u=s=>{x(s.message)};return e.jsxs("div",{children:[e.jsx("div",{className:"",children:e.jsx(p,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(y,{to:"/ticket",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"返回工单列表"]})})}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(T,{className:"text-lg",children:["# ",a.subject]})}),e.jsxs("div",{children:[e.jsx(S,{className:"h-96",ref:t,children:e.jsx("div",{className:"p-6 space-y-4",children:a.message?.map(s=>e.jsx("div",{className:`flex ${s.is_me?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-4 ${s.is_me?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.is_me?"我":"客服"}),e.jsx("span",{className:"text-xs opacity-70",children:k(s.created_at)})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.message})]})},s.id))})}),e.jsx("div",{className:"px-4",children:e.jsx(A,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(u),className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(D,{control:r.control,name:"message",render:({field:s})=>e.jsxs(I,{children:[e.jsx(M,{className:"hidden",children:"回复内容"}),e.jsx(q,{children:e.jsx(R,{placeholder:"请输入您的回复内容...",rows:4,className:"resize-none",...s})}),e.jsx(E,{})]})})}),e.jsx("div",{className:"flex md:flex-col justify-end md:justify-start",children:e.jsx(p,{type:"submit",disabled:n,children:n?"发送中...":"发送回复"})})]})})})]})]})]})};export{me as component};
