import{P as d,r as o,o as f,Q as h,S as j,t as g,j as e,L as y,s as N}from"./index-DYkXUbAd-a4e89c2.js";import{C as v,a as b,b as C}from"./card-6zQJLbWN-a4e89c2.js";import{c as R,B as p}from"./button-h1DSpZXA-a4e89c2.js";import{T}from"./textarea-NMS_hvDr-a4e89c2.js";import{S}from"./scroll-area-Dg242ysC-a4e89c2.js";import{j as k}from"./formatters-DEd21KnF-a4e89c2.js";import{e as w,u as F}from"./index.esm-5B-ngkc2-a4e89c2.js";import{u as L,a as _,F as A,b as D,c as I,d as M,e as q,f as E}from"./zod-Bbw9K68C-a4e89c2.js";import{A as H}from"./arrow-left-B-fE1lm9-a4e89c2.js";import"./utils-CqKNptqL-a4e89c2.js";import"./index-uuJbZfHU-a4e89c2.js";import"./index-DTBUfsoF-a4e89c2.js";import"./index-DSgaOyvB-a4e89c2.js";import"./index-FtHhtt_g-a4e89c2.js";import"./index-BYZA7mTK-a4e89c2.js";import"./index-BdQq_4o_-a4e89c2.js";import"./index-Dc_FVRD7-a4e89c2.js";import"./package-BqvnQu9A-a4e89c2.js";import"./circle-check-big-C7bY-h86-a4e89c2.js";import"./label-CVp5bNyn-a4e89c2.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],P=R("user",B),$=f({message:N().min(1,"请输入回复内容")}),me=function(){const{id:c}=d.useParams(),l=d.useLoaderData(),t=o.useRef(null),m=o.useRef(0),r=L({resolver:_($),defaultValues:{message:""}}),{data:a}=w(()=>h(parseInt(c)),{pollingTime:1e3,initialData:l,immediate:l.status===1});o.useEffect(()=>{if(a?.message&&t.current){const s=a.message.length;if(s>m.current){const i=t.current.querySelector('[data-slot="scroll-area-viewport"]');i&&(i.scrollTop=i.scrollHeight)}m.current=s}},[a?.message]);const{loading:n,send:x}=F(s=>j(parseInt(c),s),{immediate:!1}).onSuccess(()=>{g.success("回复成功"),r.reset()}),u=s=>{x(s.message)};return e.jsxs("div",{children:[e.jsx("div",{className:"",children:e.jsx(p,{variant:"ghost",asChild:!0,className:"mb-4",children:e.jsxs(y,{to:"/ticket",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"返回工单列表"]})})}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(C,{className:"text-lg",children:["# ",a.subject]})}),e.jsxs("div",{children:[e.jsx(S,{className:"h-96",ref:t,children:e.jsx("div",{className:"p-6 space-y-4",children:a.message?.map(s=>e.jsx("div",{className:`flex ${s.is_me?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-4 ${s.is_me?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.is_me?"我":"客服"}),e.jsx("span",{className:"text-xs opacity-70",children:k(s.created_at)})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.message})]})},s.id))})}),e.jsx("div",{className:"px-4",children:e.jsx(A,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(u),className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(D,{control:r.control,name:"message",render:({field:s})=>e.jsxs(I,{children:[e.jsx(M,{className:"hidden",children:"回复内容"}),e.jsx(q,{children:e.jsx(T,{placeholder:"请输入您的回复内容...",rows:4,className:"resize-none",...s})}),e.jsx(E,{})]})})}),e.jsx("div",{className:"flex md:flex-col justify-end md:justify-start",children:e.jsx(p,{type:"submit",disabled:n,children:n?"发送中...":"发送回复"})})]})})})]})]})]})};export{me as component};
