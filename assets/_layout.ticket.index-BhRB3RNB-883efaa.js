import{j as e,E as H,F as M,t as E,L as O,r as A,o as V,G as X,s as k,H as q}from"./index-BTP-r9xN-883efaa.js";import{u as G,a as Z,F as $,b as f,c as b,d as N,e as v,f as w}from"./zod-BpM9nMwA-883efaa.js";import{C as S,d as D}from"./card-DFSDc3C4-883efaa.js";import{T as F,a as L,b as j,c as l,d as _,e as i}from"./table-B3moId5--883efaa.js";import{B as m}from"./badge-BEQLeIYA-883efaa.js";import{c as J,B as x}from"./button-D_N_QpdM-883efaa.js";import{I as K}from"./input-CqPq1nYj-883efaa.js";import{T as Q}from"./textarea-CFW1nFZJ-883efaa.js";import{S as o}from"./skeleton-CQRWl1wB-883efaa.js";import{P as U,S as W,a as Y,b as ee,c as se,d as y}from"./select-uA0BE03X-883efaa.js";import{R as ae,b as te,C as re,a as le,T as ie,D as ne,P as oe,O as ce}from"./index-Cw9EzqkR-883efaa.js";import{c as h}from"./utils-0Qfy9_Vr-883efaa.js";import{X as de}from"./x-C9eyygZO-883efaa.js";import{d as z,h as B,C as me}from"./formatters-CmpZCSSN-883efaa.js";import{P as xe,E as he}from"./page-header-B568hy9o-883efaa.js";import{u as T,a as je,b as ue}from"./index.esm-CX9a1_GC-883efaa.js";import{T as P}from"./ticket-DL7c4nq0-883efaa.js";import{C as I}from"./circle-check-big-uhs5T-oi-883efaa.js";import"./label-Cg9jGNXT-883efaa.js";import"./index-t-hmN7NP-883efaa.js";import"./index-BdQq_4o_-883efaa.js";import"./index-Dc_FVRD7-883efaa.js";import"./index-C7lC3y2O-883efaa.js";import"./index-Ds3d7f0J-883efaa.js";import"./index-BaRRu7vB-883efaa.js";import"./index-CEwW9QtX-883efaa.js";import"./index-BxzUmDID-883efaa.js";import"./index-DKp-ssIh-883efaa.js";import"./tslib.es6-B8VhMk5P-883efaa.js";import"./index-Cm61erdP-883efaa.js";import"./index-Bv24Bbth-883efaa.js";import"./index-ByuYKPxO-883efaa.js";import"./index-UpFWzIoV-883efaa.js";import"./chevron-down-BDOW9-Y4-883efaa.js";import"./check-DbF3TNW8-883efaa.js";import"./chevron-up-gU_D3LBP-883efaa.js";import"./index-DialYb4e-883efaa.js";import"./package-CPF5I9LQ-883efaa.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],u=J("message-circle",ge);function pe({...a}){return e.jsx(ae,{"data-slot":"dialog",...a})}function fe({...a}){return e.jsx(te,{"data-slot":"dialog-trigger",...a})}function be({...a}){return e.jsx(oe,{"data-slot":"dialog-portal",...a})}function Ne({className:a,...t}){return e.jsx(ce,{"data-slot":"dialog-overlay",className:h("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...t})}function ve({className:a,children:t,showCloseButton:n=!0,...d}){return e.jsxs(be,{"data-slot":"dialog-portal",children:[e.jsx(Ne,{}),e.jsxs(re,{"data-slot":"dialog-content",className:h("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...d,children:[t,n&&e.jsxs(le,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(de,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function we({className:a,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:h("flex flex-col gap-2 text-center sm:text-left",a),...t})}function ye({className:a,...t}){return e.jsx(ie,{"data-slot":"dialog-title",className:h("text-lg leading-none font-semibold",a),...t})}function Te({className:a,...t}){return e.jsx(ne,{"data-slot":"dialog-description",className:h("text-muted-foreground text-sm",a),...t})}const Ce=V({subject:k().min(1,"请输入工单主题"),level:q().min(0).max(2),message:k().min(1,"请输入问题描述").min(5,"问题描述至少需要5个字符")});function R(){const[a,t]=A.useState(!1),n=G({resolver:Z(Ce),defaultValues:{subject:"",level:0,message:""}}),{loading:d,send:g}=T(r=>X(r),{immediate:!1}).onSuccess(()=>{E.success("工单创建成功"),t(!1),n.reset(),ue("getTicketList",r=>{r.send(!0)})}),p=r=>{g(r)};return e.jsxs(pe,{open:a,onOpenChange:t,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(U,{className:"h-4 w-4"}),"创建工单"]})}),e.jsxs(ve,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsx(ye,{children:"创建新工单"}),e.jsx(Te,{children:"请详细描述您遇到的问题，我们会尽快为您处理。"})]}),e.jsx($,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(p),className:"space-y-4",children:[e.jsx(f,{control:n.control,name:"subject",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"工单主题"}),e.jsx(v,{children:e.jsx(K,{placeholder:"请输入工单主题",...r})}),e.jsx(w,{})]})}),e.jsx(f,{control:n.control,name:"level",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"优先级"}),e.jsxs(W,{onValueChange:s=>r.onChange(parseInt(s)),defaultValue:r.value.toString(),children:[e.jsx(v,{children:e.jsx(Y,{children:e.jsx(ee,{placeholder:"选择优先级"})})}),e.jsxs(se,{children:[e.jsx(y,{value:"0",children:"低优先级"}),e.jsx(y,{value:"1",children:"中优先级"}),e.jsx(y,{value:"2",children:"高优先级"})]})]}),e.jsx(w,{})]})}),e.jsx(f,{control:n.control,name:"message",render:({field:r})=>e.jsxs(b,{children:[e.jsx(N,{children:"问题描述"}),e.jsx(v,{children:e.jsx(Q,{placeholder:"请详细描述您遇到的问题...",rows:4,...r})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>t(!1),children:"取消"}),e.jsx(x,{type:"submit",disabled:d,children:d?"创建中...":"创建工单"})]})]})})]})]})}const ds=function(){const{data:t,loading:n,send:d}=T(H,{middleware:je("getTicketList"),force:({args:s})=>!!s[0]}),{send:g}=T(s=>M(s),{immediate:!1}).onSuccess(()=>{E.success("工单已关闭"),d(!0)}),p=(s,c)=>s===0?c===1?e.jsxs(m,{variant:"default",className:"bg-blue-500/20 text-blue-600 border-blue-500/30",children:[e.jsx(u,{className:"h-3 w-3"})," 待回复"]}):c===0?e.jsxs(m,{variant:"outline",className:"bg-purple-500/10 text-purple-600 border-purple-500/30",children:[e.jsx(I,{className:"h-3 w-3"})," 已回复"]}):e.jsxs(m,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(I,{className:"h-3 w-3"})," 进行中"]}):e.jsxs(m,{variant:"outline",className:"bg-red-500/10 text-red-500 border-red-500/30",children:[e.jsx(B,{className:"h-3 w-3"})," 已关闭"]}),r=s=>{const c={0:{text:"低",color:"bg-gray-500/20 text-gray-600 border-gray-500/30"},1:{text:"中",color:"bg-yellow-500/20 text-yellow-600 border-yellow-500/30"},2:{text:"高",color:"bg-red-500/20 text-red-600 border-red-500/30"}},C=c[s]||c[1];return e.jsxs(m,{variant:"outline",className:C.color,children:[e.jsx(me,{className:"h-3 w-3"})," ",C.text]})};return e.jsxs("div",{className:"container mx-auto space-y-6",children:[e.jsx(xe,{title:"工单管理",description:"提交技术支持请求，查看工单处理状态",icon:P}),n?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"我的工单"}),e.jsx(o,{className:"h-6 w-20"})]}),e.jsx(R,{})]}),e.jsx(S,{className:"rounded-xl shadow-lg border border-border overflow-hidden",children:e.jsx(D,{className:"p-0",children:e.jsxs(F,{className:"table-auto",children:[e.jsx(L,{children:e.jsxs(j,{className:"bg-muted",children:[e.jsx(l,{children:"主题"}),e.jsx(l,{children:"工单级别"}),e.jsx(l,{children:"工单状态"}),e.jsx(l,{children:"创建时间"}),e.jsx(l,{children:"最后回复时间"}),e.jsx(l,{className:"sticky right-0 border-l bg-muted",children:"操作"})]})}),e.jsx(_,{children:Array.from({length:5}).map((s,c)=>e.jsxs(j,{children:[e.jsx(i,{children:e.jsx(o,{className:"h-4 w-48"})}),e.jsx(i,{children:e.jsx(o,{className:"h-6 w-16"})}),e.jsx(i,{children:e.jsx(o,{className:"h-6 w-20"})}),e.jsx(i,{children:e.jsx(o,{className:"h-4 w-32"})}),e.jsx(i,{children:e.jsx(o,{className:"h-4 w-32"})}),e.jsx(i,{className:"sticky right-0 bg-background border-l",children:e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx(o,{className:"h-8 w-16"}),e.jsx(o,{className:"h-8 w-16"})]})})]},c))})]})})})]}):t.length===0?e.jsx(he,{icon:P,title:"暂无工单",description:"您还没有提交过任何工单。如果遇到问题，请创建新工单获取技术支持。"}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold",children:"我的工单"}),e.jsxs(m,{variant:"outline",className:"ml-2",children:["共 ",t.length," 个工单"]})]}),e.jsx(R,{})]}),e.jsx(S,{className:"rounded-xl shadow-lg border border-border overflow-hidden",children:e.jsx(D,{className:"p-0",children:e.jsxs(F,{className:"table-auto",children:[e.jsx(L,{children:e.jsxs(j,{className:"bg-muted",children:[e.jsx(l,{children:"主题"}),e.jsx(l,{children:"工单级别"}),e.jsx(l,{children:"工单状态"}),e.jsx(l,{children:"创建时间"}),e.jsx(l,{children:"最后回复时间"}),e.jsx(l,{className:"sticky right-0 border-l bg-muted",children:"操作"})]})}),e.jsx(_,{children:t.map(s=>e.jsxs(j,{children:[e.jsx(i,{children:e.jsx("div",{className:"font-semibold",children:s.subject})}),e.jsx(i,{children:r(s.level)}),e.jsx(i,{children:p(s.status,s.reply_status)}),e.jsx(i,{children:e.jsx("div",{className:"text-sm",children:z(s.created_at)})}),e.jsx(i,{children:e.jsx("div",{className:"text-sm",children:z(s.updated_at)})}),e.jsx(i,{className:"sticky right-0 bg-background border-l",children:e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx(O,{to:"/ticket/$id",from:"/",params:{id:s.id.toString()},children:e.jsxs(x,{variant:"outline",size:"sm",className:"text-xs px-2 py-1",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"查看"})]})}),e.jsxs(x,{variant:"outline",size:"sm",className:"text-xs px-2 py-1",onClick:()=>g(s.id),disabled:s.status!==0,children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"取消"})]})]})})]},s.id))})]})})})]})]})};export{ds as component};
