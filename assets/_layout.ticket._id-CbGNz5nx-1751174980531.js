import{r as i,j as n,Q as B,o as ce,S as ie,T as de,t as ue,L as fe,s as he}from"./index-zp2nMl9D-1751174980531.js";import{C as me,a as pe,b as be}from"./card-Dg8wDAoB-1751174980531.js";import{B as V}from"./button-Cqc4v3GU-1751174980531.js";import{T as ve}from"./textarea-HhSrWfPG-1751174980531.js";import{P as A}from"./index-BT14nGiI-1751174980531.js";import{P as I}from"./index-CgLCRNYN-1751174980531.js";import{c as Se,u as we}from"./index-Decz7uho-1751174980531.js";import{u as T,c as $}from"./utils-BIJI3SUY-1751174980531.js";import{u as C}from"./index-ZA55Yug1-1751174980531.js";import{u as xe}from"./index-9xs1tbkJ-1751174980531.js";import{c as ge}from"./index-BdQq_4o_-1751174980531.js";import{c as P}from"./index-Dc_FVRD7-1751174980531.js";import{j as Ce}from"./formatters-C5M2-kaB-1751174980531.js";import{f as Pe,u as Re}from"./index.esm-B4TPyIND-1751174980531.js";import{u as ye,a as Te,F as Ee,b as je,c as Ae,d as Le,e as _e,f as Ne}from"./zod-BqX1wKj--1751174980531.js";import{A as De}from"./arrow-left-Dif_Ckq6-1751174980531.js";import{c as He}from"./createLucideIcon-Ru6o5lSX-1751174980531.js";import"./package-CC7CMkB8-1751174980531.js";import"./circle-check-big-DX17IEmj-1751174980531.js";import"./label-pehihN3l-1751174980531.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ze=He("user",We);function Ie(e,o){return i.useReducer((r,s)=>o[r][s]??r,e)}var X="ScrollArea",[Q,gr]=Se(X),[Oe,v]=Q(X),G=i.forwardRef((e,o)=>{const{__scopeScrollArea:r,type:s="hover",dir:t,scrollHideDelay:l=600,...c}=e,[d,u]=i.useState(null),[f,a]=i.useState(null),[m,h]=i.useState(null),[p,w]=i.useState(null),[E,M]=i.useState(null),[g,L]=i.useState(0),[F,_]=i.useState(0),[N,j]=i.useState(!1),[D,H]=i.useState(!1),b=T(o,R=>u(R)),S=xe(t);return n.jsx(Oe,{scope:r,type:s,dir:S,scrollHideDelay:l,scrollArea:d,viewport:f,onViewportChange:a,content:m,onContentChange:h,scrollbarX:p,onScrollbarXChange:w,scrollbarXEnabled:N,onScrollbarXEnabledChange:j,scrollbarY:E,onScrollbarYChange:M,scrollbarYEnabled:D,onScrollbarYEnabledChange:H,onCornerWidthChange:L,onCornerHeightChange:_,children:n.jsx(A.div,{dir:S,...c,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":F+"px",...e.style}})})});G.displayName=X;var J="ScrollAreaViewport",K=i.forwardRef((e,o)=>{const{__scopeScrollArea:r,children:s,nonce:t,...l}=e,c=v(J,r),d=i.useRef(null),u=T(o,d,c.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:t}),n.jsx(A.div,{"data-radix-scroll-area-viewport":"",...l,ref:u,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});K.displayName=J;var x="ScrollAreaScrollbar",Z=i.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=v(x,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:c}=t,d=e.orientation==="horizontal";return i.useEffect(()=>(d?l(!0):c(!0),()=>{d?l(!1):c(!1)}),[d,l,c]),t.type==="hover"?n.jsx(ke,{...s,ref:o,forceMount:r}):t.type==="scroll"?n.jsx(Me,{...s,ref:o,forceMount:r}):t.type==="auto"?n.jsx(ee,{...s,ref:o,forceMount:r}):t.type==="always"?n.jsx(Y,{...s,ref:o}):null});Z.displayName=x;var ke=i.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=v(x,e.__scopeScrollArea),[l,c]=i.useState(!1);return i.useEffect(()=>{const d=t.scrollArea;let u=0;if(d){const f=()=>{window.clearTimeout(u),c(!0)},a=()=>{u=window.setTimeout(()=>c(!1),t.scrollHideDelay)};return d.addEventListener("pointerenter",f),d.addEventListener("pointerleave",a),()=>{window.clearTimeout(u),d.removeEventListener("pointerenter",f),d.removeEventListener("pointerleave",a)}}},[t.scrollArea,t.scrollHideDelay]),n.jsx(I,{present:r||l,children:n.jsx(ee,{"data-state":l?"visible":"hidden",...s,ref:o})})}),Me=i.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=v(x,e.__scopeScrollArea),l=e.orientation==="horizontal",c=k(()=>u("SCROLL_END"),100),[d,u]=Ie("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(d==="idle"){const f=window.setTimeout(()=>u("HIDE"),t.scrollHideDelay);return()=>window.clearTimeout(f)}},[d,t.scrollHideDelay,u]),i.useEffect(()=>{const f=t.viewport,a=l?"scrollLeft":"scrollTop";if(f){let m=f[a];const h=()=>{const p=f[a];m!==p&&(u("SCROLL"),c()),m=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[t.viewport,l,u,c]),n.jsx(I,{present:r||d!=="hidden",children:n.jsx(Y,{"data-state":d==="hidden"?"hidden":"visible",...s,ref:o,onPointerEnter:P(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:P(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),ee=i.forwardRef((e,o)=>{const r=v(x,e.__scopeScrollArea),{forceMount:s,...t}=e,[l,c]=i.useState(!1),d=e.orientation==="horizontal",u=k(()=>{if(r.viewport){const f=r.viewport.offsetWidth<r.viewport.scrollWidth,a=r.viewport.offsetHeight<r.viewport.scrollHeight;c(d?f:a)}},10);return y(r.viewport,u),y(r.content,u),n.jsx(I,{present:s||l,children:n.jsx(Y,{"data-state":l?"visible":"hidden",...t,ref:o})})}),Y=i.forwardRef((e,o)=>{const{orientation:r="vertical",...s}=e,t=v(x,e.__scopeScrollArea),l=i.useRef(null),c=i.useRef(0),[d,u]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=le(d.viewport,d.content),a={...s,sizes:d,onSizesChange:u,hasThumb:f>0&&f<1,onThumbChange:h=>l.current=h,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:h=>c.current=h};function m(h,p){return Ve(h,c.current,d,p)}return r==="horizontal"?n.jsx(Fe,{...a,ref:o,onThumbPositionChange:()=>{if(t.viewport&&l.current){const h=t.viewport.scrollLeft,p=q(h,d,t.dir);l.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{t.viewport&&(t.viewport.scrollLeft=h)},onDragScroll:h=>{t.viewport&&(t.viewport.scrollLeft=m(h,t.dir))}}):r==="vertical"?n.jsx(Xe,{...a,ref:o,onThumbPositionChange:()=>{if(t.viewport&&l.current){const h=t.viewport.scrollTop,p=q(h,d);l.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{t.viewport&&(t.viewport.scrollTop=h)},onDragScroll:h=>{t.viewport&&(t.viewport.scrollTop=m(h))}}):null}),Fe=i.forwardRef((e,o)=>{const{sizes:r,onSizesChange:s,...t}=e,l=v(x,e.__scopeScrollArea),[c,d]=i.useState(),u=i.useRef(null),f=T(o,u,l.onScrollbarXChange);return i.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),n.jsx(oe,{"data-orientation":"horizontal",...t,ref:f,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":O(r)+"px",...e.style},onThumbPointerDown:a=>e.onThumbPointerDown(a.x),onDragScroll:a=>e.onDragScroll(a.x),onWheelScroll:(a,m)=>{if(l.viewport){const h=l.viewport.scrollLeft+a.deltaX;e.onWheelScroll(h),ae(h,m)&&a.preventDefault()}},onResize:()=>{u.current&&l.viewport&&c&&s({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:z(c.paddingLeft),paddingEnd:z(c.paddingRight)}})}})}),Xe=i.forwardRef((e,o)=>{const{sizes:r,onSizesChange:s,...t}=e,l=v(x,e.__scopeScrollArea),[c,d]=i.useState(),u=i.useRef(null),f=T(o,u,l.onScrollbarYChange);return i.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),n.jsx(oe,{"data-orientation":"vertical",...t,ref:f,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":O(r)+"px",...e.style},onThumbPointerDown:a=>e.onThumbPointerDown(a.y),onDragScroll:a=>e.onDragScroll(a.y),onWheelScroll:(a,m)=>{if(l.viewport){const h=l.viewport.scrollTop+a.deltaY;e.onWheelScroll(h),ae(h,m)&&a.preventDefault()}},onResize:()=>{u.current&&l.viewport&&c&&s({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:z(c.paddingTop),paddingEnd:z(c.paddingBottom)}})}})}),[Ye,re]=Q(x),oe=i.forwardRef((e,o)=>{const{__scopeScrollArea:r,sizes:s,hasThumb:t,onThumbChange:l,onThumbPointerUp:c,onThumbPointerDown:d,onThumbPositionChange:u,onDragScroll:f,onWheelScroll:a,onResize:m,...h}=e,p=v(x,r),[w,E]=i.useState(null),M=T(o,b=>E(b)),g=i.useRef(null),L=i.useRef(""),F=p.viewport,_=s.content-s.viewport,N=C(a),j=C(u),D=k(m,10);function H(b){if(g.current){const S=b.clientX-g.current.left,R=b.clientY-g.current.top;f({x:S,y:R})}}return i.useEffect(()=>{const b=S=>{const R=S.target;w?.contains(R)&&N(S,_)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[F,w,_,N]),i.useEffect(j,[s,j]),y(w,D),y(p.content,D),n.jsx(Ye,{scope:r,scrollbar:w,hasThumb:t,onThumbChange:C(l),onThumbPointerUp:C(c),onThumbPositionChange:j,onThumbPointerDown:C(d),children:n.jsx(A.div,{...h,ref:M,style:{position:"absolute",...h.style},onPointerDown:P(e.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),g.current=w.getBoundingClientRect(),L.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),H(b))}),onPointerMove:P(e.onPointerMove,H),onPointerUp:P(e.onPointerUp,b=>{const S=b.target;S.hasPointerCapture(b.pointerId)&&S.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=L.current,p.viewport&&(p.viewport.style.scrollBehavior=""),g.current=null})})})}),W="ScrollAreaThumb",te=i.forwardRef((e,o)=>{const{forceMount:r,...s}=e,t=re(W,e.__scopeScrollArea);return n.jsx(I,{present:r||t.hasThumb,children:n.jsx(Ue,{ref:o,...s})})}),Ue=i.forwardRef((e,o)=>{const{__scopeScrollArea:r,style:s,...t}=e,l=v(W,r),c=re(W,r),{onThumbPositionChange:d}=c,u=T(o,m=>c.onThumbChange(m)),f=i.useRef(void 0),a=k(()=>{f.current&&(f.current(),f.current=void 0)},100);return i.useEffect(()=>{const m=l.viewport;if(m){const h=()=>{if(a(),!f.current){const p=qe(m,d);f.current=p,d()}};return d(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[l.viewport,a,d]),n.jsx(A.div,{"data-state":c.hasThumb?"visible":"hidden",...t,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:P(e.onPointerDownCapture,m=>{const p=m.target.getBoundingClientRect(),w=m.clientX-p.left,E=m.clientY-p.top;c.onThumbPointerDown({x:w,y:E})}),onPointerUp:P(e.onPointerUp,c.onThumbPointerUp)})});te.displayName=W;var U="ScrollAreaCorner",ne=i.forwardRef((e,o)=>{const r=v(U,e.__scopeScrollArea),s=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&s?n.jsx(Be,{...e,ref:o}):null});ne.displayName=U;var Be=i.forwardRef((e,o)=>{const{__scopeScrollArea:r,...s}=e,t=v(U,r),[l,c]=i.useState(0),[d,u]=i.useState(0),f=!!(l&&d);return y(t.scrollbarX,()=>{const a=t.scrollbarX?.offsetHeight||0;t.onCornerHeightChange(a),u(a)}),y(t.scrollbarY,()=>{const a=t.scrollbarY?.offsetWidth||0;t.onCornerWidthChange(a),c(a)}),f?n.jsx(A.div,{...s,ref:o,style:{width:l,height:d,position:"absolute",right:t.dir==="ltr"?0:void 0,left:t.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function z(e){return e?parseInt(e,10):0}function le(e,o){const r=e/o;return isNaN(r)?0:r}function O(e){const o=le(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-r)*o;return Math.max(s,18)}function Ve(e,o,r,s="ltr"){const t=O(r),l=t/2,c=o||l,d=t-c,u=r.scrollbar.paddingStart+c,f=r.scrollbar.size-r.scrollbar.paddingEnd-d,a=r.content-r.viewport,m=s==="ltr"?[0,a]:[a*-1,0];return se([u,f],m)(e)}function q(e,o,r="ltr"){const s=O(o),t=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,l=o.scrollbar.size-t,c=o.content-o.viewport,d=l-s,u=r==="ltr"?[0,c]:[c*-1,0],f=ge(e,u);return se([0,c],[0,d])(f)}function se(e,o){return r=>{if(e[0]===e[1]||o[0]===o[1])return o[0];const s=(o[1]-o[0])/(e[1]-e[0]);return o[0]+s*(r-e[0])}}function ae(e,o){return e>0&&e<o}var qe=(e,o=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},s=0;return function t(){const l={left:e.scrollLeft,top:e.scrollTop},c=r.left!==l.left,d=r.top!==l.top;(c||d)&&o(),r=l,s=window.requestAnimationFrame(t)}(),()=>window.cancelAnimationFrame(s)};function k(e,o){const r=C(e),s=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(s.current),[]),i.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(r,o)},[r,o])}function y(e,o){const r=C(o);we(()=>{let s=0;if(e){const t=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(r)});return t.observe(e),()=>{window.cancelAnimationFrame(s),t.unobserve(e)}}},[e,r])}var $e=G,Qe=K,Ge=ne;function Je({className:e,children:o,...r}){return n.jsxs($e,{"data-slot":"scroll-area",className:$("relative",e),...r,children:[n.jsx(Qe,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:o}),n.jsx(Ke,{}),n.jsx(Ge,{})]})}function Ke({className:e,orientation:o="vertical",...r}){return n.jsx(Z,{"data-slot":"scroll-area-scrollbar",orientation:o,className:$("flex touch-none p-px transition-colors select-none",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",e),...r,children:n.jsx(te,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const Ze=ce({message:he().min(1,"请输入回复内容")}),Cr=function(){const{id:o}=B.useParams(),r=B.useLoaderData(),s=i.useRef(null),t=i.useRef(0),l=ye({resolver:Te(Ze),defaultValues:{message:""}}),{data:c}=Pe(()=>ie(parseInt(o)),{pollingTime:1e3,initialData:r,immediate:r.status===1});i.useEffect(()=>{if(c?.message&&s.current){const a=c.message.length;if(a>t.current){const m=s.current.querySelector('[data-slot="scroll-area-viewport"]');m&&(m.scrollTop=m.scrollHeight)}t.current=a}},[c?.message]);const{loading:d,send:u}=Re(a=>de(parseInt(o),a),{immediate:!1}).onSuccess(()=>{ue.success("回复成功"),l.reset()}),f=a=>{u(a.message)};return n.jsxs("div",{children:[n.jsx("div",{className:"",children:n.jsx(V,{variant:"ghost",asChild:!0,className:"mb-4",children:n.jsxs(fe,{to:"/ticket",children:[n.jsx(De,{className:"h-4 w-4 mr-2"}),"返回工单列表"]})})}),n.jsxs(me,{children:[n.jsx(pe,{children:n.jsxs(be,{className:"text-lg",children:["# ",c.subject]})}),n.jsxs("div",{children:[n.jsx(Je,{className:"h-96",ref:s,children:n.jsx("div",{className:"p-6 space-y-4",children:c.message?.map(a=>n.jsx("div",{className:`flex ${a.is_me?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`max-w-[80%] rounded-lg p-4 ${a.is_me?"bg-primary text-primary-foreground":"bg-muted"}`,children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx(ze,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-medium",children:a.is_me?"我":"客服"}),n.jsx("span",{className:"text-xs opacity-70",children:Ce(a.created_at)})]}),n.jsx("div",{className:"whitespace-pre-wrap",children:a.message})]})},a.id))})}),n.jsx("div",{className:"px-4",children:n.jsx(Ee,{...l,children:n.jsxs("form",{onSubmit:l.handleSubmit(f),className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsx(je,{control:l.control,name:"message",render:({field:a})=>n.jsxs(Ae,{children:[n.jsx(Le,{className:"hidden",children:"回复内容"}),n.jsx(_e,{children:n.jsx(ve,{placeholder:"请输入您的回复内容...",rows:4,className:"resize-none",...a})}),n.jsx(Ne,{})]})})}),n.jsx("div",{className:"flex md:flex-col justify-end md:justify-start",children:n.jsx(V,{type:"submit",disabled:d,children:d?"发送中...":"发送回复"})})]})})})]})]})]})};export{Cr as component};
