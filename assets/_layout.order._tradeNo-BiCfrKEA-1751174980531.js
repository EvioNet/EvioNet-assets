import{W as I,r as g,X as M,N as L,t as i,Y as T,Z as G,j as e,L as R}from"./index-zp2nMl9D-1751174980531.js";import{B as f}from"./button-Cqc4v3GU-1751174980531.js";import{C as N,a as j,b,d as y}from"./card-Dg8wDAoB-1751174980531.js";import{S as F}from"./separator-B_llpgAs-1751174980531.js";import{B as $}from"./badge-CwNxBKv8-1751174980531.js";import{i as q,l as B,j as H,b as c,h as U}from"./formatters-C5M2-kaB-1751174980531.js";import{A as X,a as z,b as K,c as W,d as Y,e as Z,f as J,g as Q,h as V}from"./alert-dialog-DfTWEJKU-1751174980531.js";import{u as _,b as ee,f as se,c as x}from"./index.esm-B4TPyIND-1751174980531.js";import{A as ae}from"./arrow-left-Dif_Ckq6-1751174980531.js";import{F as te}from"./file-text-CuWBQU5q-1751174980531.js";import{C as D}from"./calendar-BN7KGhqQ-1751174980531.js";import{P as k}from"./package-CC7CMkB8-1751174980531.js";import{C as re}from"./check-tZh8Fil0-1751174980531.js";import{c as le}from"./createLucideIcon-Ru6o5lSX-1751174980531.js";import{C as ne}from"./credit-card-vtF1NXY5-1751174980531.js";import"./utils-BIJI3SUY-1751174980531.js";import"./index-BT14nGiI-1751174980531.js";import"./circle-check-big-DX17IEmj-1751174980531.js";import"./index-Decz7uho-1751174980531.js";import"./index-CYCNFEZA-1751174980531.js";import"./index-Dc_FVRD7-1751174980531.js";import"./index-BMVtMRz9-1751174980531.js";import"./index-ZA55Yug1-1751174980531.js";import"./index-CjSUaoDh-1751174980531.js";import"./index-BZhyglrc-1751174980531.js";import"./tslib.es6-B8VhMk5P-1751174980531.js";import"./index-CgLCRNYN-1751174980531.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],de=le("dollar-sign",ie),l={PENDING:0,PROCESSING:1,CANCELLED:2,COMPLETED:3,DEDUCTED:4},ce=[{key:"month_price",label:"月付"},{key:"quarter_price",label:"季付"},{key:"half_year_price",label:"半年付"},{key:"year_price",label:"年付"},{key:"two_year_price",label:"两年付"},{key:"three_year_price",label:"三年付"},{key:"onetime_price",label:"一次性"},{key:"reset_price",label:"流量重置包"}],oe=u=>{const r=ce.find(n=>n.key===u);return r?r.label:u},Re=function(){const r=I.useLoaderData(),[n,p]=g.useState(null),{data:s}=_(M(r.order.trade_no),{initialData:r.order,middleware:ee("getOrderDetail"),force:({args:a})=>!!a[0]}),d=q(s.status,!0),v=B(s.type),C=d.icon,{send:E,loading:m}=_(L,{immediate:!1}).onSuccess(()=>{i.success("订单已取消")});se(T(s.trade_no),{pollingTime:s.status===l.PENDING?1e3:0,middleware(a,t){s.status===l.PENDING&&t()}}).onSuccess(({data:a})=>{switch(a){case l.PENDING:break;case l.PROCESSING:i.info("订单正在开通中..."),x("getOrderDetail",t=>{t.send(!0)});break;case l.CANCELLED:i.error("订单已被取消"),x("getOrderDetail",t=>{t.send(!0)});break;case l.COMPLETED:i.success("订单已支付完成"),x("getOrderDetail",t=>{t.send(!0)});break;case l.DEDUCTED:i.success("订单已完成折抵"),x("getOrderDetail",t=>{t.send(!0)});break;default:console.warn("未知的订单状态:",a);break}});const{send:O,loading:w}=_(G,{immediate:!1}).onSuccess(({data:a})=>{a!==!0&&(typeof a=="string"&&a.trim()?(window.open(a,"_blank"),i.success("正在跳转到支付页面...")):i.error("获取支付链接失败"))});g.useEffect(()=>{r.paymentMethods&&r.paymentMethods.length>0&&n===null&&p(r.paymentMethods[0].id)},[r.paymentMethods,n]);const h=g.useMemo(()=>{if(!n||!r.paymentMethods)return 0;const a=r.paymentMethods.find(P=>P.id===n);if(!a)return 0;const t=s.total_amount||0;if(t===0)return 0;const o=Number(a.handling_fee_fixed)||0,S=Number(a.handling_fee_percent)||0,A=t*S/100;return o+A},[n,r.paymentMethods,s.total_amount]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{to:"/order",children:e.jsxs(f,{variant:"ghost",size:"sm",className:"h-9 px-3",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"返回订单列表"}),e.jsx("span",{className:"sm:hidden",children:"返回"})]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"订单详情"})})]}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${d.bgColor} ${d.borderColor} shadow-sm`,children:[e.jsx(C,{className:`h-5 w-5 ${d.color}`}),e.jsx("span",{className:`font-semibold ${d.color}`,children:d.label})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[e.jsxs(N,{children:[e.jsx(j,{className:"pb-4",children:e.jsxs(b,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(te,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),"订单信息"]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"订单号"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.trade_no})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"创建时间"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:H(s.created_at)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"订单类型"]}),e.jsx($,{className:`text-xs ${v.color}`,children:v.label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"套餐名称"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.plan.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"流量配额"]}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[s.plan.transfer_enable," GB"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"服务周期"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:oe(s.period)})]})]})})]}),s.status===l.PENDING&&e.jsxs(N,{children:[e.jsx(j,{children:e.jsx(b,{children:"选择支付方式"})}),e.jsxs(y,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:r.paymentMethods.map(a=>{const t=n===a.id;return e.jsxs("div",{className:`relative cursor-pointer rounded-lg border-2 p-4 transition-all duration-200 ${t?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,onClick:()=>p(a.id),onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),p(a.id))},tabIndex:0,role:"button","aria-pressed":t,children:[t&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(re,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:a.icon,alt:a.name,className:"h-8 w-8 object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${t?"text-primary":"text-foreground"}`,children:a.name}),(Number(a.handling_fee_fixed)>0||Number(a.handling_fee_percent)>0)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["手续费:",a.handling_fee_fixed>0&&`¥${(a.handling_fee_fixed/100).toFixed(2)}`,Number(a.handling_fee_fixed)>0&&Number(a.handling_fee_percent)>0&&" + ",Number(a.handling_fee_percent)>0&&`${a.handling_fee_percent}%`]})]})]})]},a.id)})}),r.paymentMethods.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"暂无可用的支付方式"})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(N,{children:[e.jsx(j,{className:"pb-4",children:e.jsxs(b,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900 rounded-lg",children:e.jsx(de,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400"})}),"金额明细"]})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"原价"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["¥",c(Number(s.plan[s.period]))]})]}),s.discount_amount&&s.discount_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"优惠金额"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["-¥",c(s.discount_amount)]})]}),s.balance_amount&&s.balance_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"余额抵扣"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["-¥",c(s.balance_amount)]})]}),s.refund_amount&&s.refund_amount>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"退款金额"}),e.jsxs("span",{className:"font-semibold text-red-600",children:["¥",c(s.refund_amount)]})]}),s.status===l.PENDING&&h>0&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"手续费"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:["¥",c(h)]})]}),e.jsx(F,{className:"my-3"}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"应付金额"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["¥",c(s.status===l.PENDING?s.total_amount+h:s.total_amount)]})]}),s.status===l.PENDING&&e.jsxs(f,{className:"w-full h-12 text-base font-semibold bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n||w,onClick:()=>{n&&O(s.trade_no,n)},children:[e.jsx(ne,{className:"mr-2 h-5 w-5"}),w?"处理中...":"立即支付"]}),s.status===l.PENDING&&e.jsxs(X,{children:[e.jsx(z,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full h-11 border-red-200 text-red-600 hover:bg-red-50",disabled:m,children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),m?"取消中...":"取消订单"]})}),e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsx(Y,{children:"确认取消订单"}),e.jsx(Z,{children:"确定要取消订单吗？如果您已经付款，取消订单可能会导致支付失败！"})]}),e.jsxs(J,{children:[e.jsx(Q,{children:"取消"}),e.jsx(V,{onClick:async()=>{E(s.trade_no)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:m,children:m?"取消中...":"确认取消"})]})]})]})]})]})})]})]})};export{Re as component};
